<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boiby</title>
    <link id="themeStylesheet" href="/ban-new.css" rel="stylesheet" type="text/css" media="all">
	<style>
* {
	font-family: "Inter", serif!important;
}
.modal-button.disabled-button {
    border: 2px solid #ccc; /* Outline */
    display: flex;
    align-items: center;
    gap: 8px;
}

.modal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.9);
  opacity: 0;
  z-index: 1000;
  transition: opacity 0.25s ease, transform 0.25s ease;
  pointer-events: none;
  width: 600px;
  max-width: 92%;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  padding: 24px;
  box-sizing: border-box;
  max-height: 85vh;
  display: flex;
  flex-direction: column;
}

.modal.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
  pointer-events: auto;
  max-width: 100%;
}

/* Scrollable content area */
.div-outer-scroll-box {
  flex: 1;
  overflow-y: auto;
  padding-right: 0px; /* 6px */
  box-sizing: border-box;
  position: relative;
}

.div-outer-scroll-box::after {
  content: '';
  position: sticky;
  bottom: 0;
  left: 0;
  right: 8px;
  height: 40px;
  background: linear-gradient(to top, 
    #fff 0%, 
    transparent 100%);
  pointer-events: none;
  z-index: 2;
  display: block;
  margin-top: -40px;
}

/* Sticky footer */
#actionButtons {
  background: #fff;
  padding: 24px 0 8px 0;
  margin-top: -20px;
  position: relative;
  z-index: 3;
}
.modal-footer.dual-buttons ~ .div-outer-scroll-box::after,
#actionButtons.dual-buttons ~ .div-outer-scroll-box::after {
  display: none;
}

.div-outer-scroll-box:has(~ .modal-footer.dual-buttons)::after,
.div-outer-scroll-box:has(~ #actionButtons.dual-buttons)::after {
  display: none;
}

.div-outer-scroll-box[data-no-fade="true"]::after {
  display: none;
}
/* Dark mode support */
body.dark-mode .div-outer-scroll-box::after {
  background: linear-gradient(to top, 
    #1e1e1e 0%, 
    transparent 100%);
}

body.dark-mode #actionButtons {
  background: #1e1e1e;
}

/* Custom scrollbar */
.div-outer-scroll-box::-webkit-scrollbar {
  width: 8px;
}

.div-outer-scroll-box::-webkit-scrollbar-track {
  background: transparent;
  margin: 1px 0; /* 8px 0 */
}

.div-outer-scroll-box::-webkit-scrollbar-thumb {
  background: #ccc;
  border-radius: 4px;
}

.div-outer-scroll-box::-webkit-scrollbar-thumb:hover {
  background: #aaa;
}

.div-outer-scroll-box {
  scrollbar-width: thin;
  scrollbar-color: #ccc transparent;
}

body.dark-mode .div-outer-scroll-box::-webkit-scrollbar-thumb {
  background: #555;
}

body.dark-mode .div-outer-scroll-box::-webkit-scrollbar-thumb:hover {
  background: #777;
}

body.dark-mode .div-outer-scroll-box {
  scrollbar-color: #555 transparent;
}
		
.suspension-text {
    font-weight: bold; 
}
.evidence-content {
    display: block;
    margin-top: 0px;
    margin-bottom: 4px;
    transition: max-height 0.3s ease-out, opacity 0.3s ease;
    overflow: hidden;
}

.evidence-content.hidden {
    max-height: 0;
    opacity: 0;
}

		
.evidence-content.visible {
    opacity: 1;
}

.view-toggle {
    color: #0066cc;
    cursor: pointer;
    font-size: 14px;
    margin-top: 8px;
    display: inline-block;
}

.view-toggle:hover {
    text-decoration: underline;
}
</style>
     <style>
.ban-modal {
  width: 600px;
  max-width: 92%
}

/* Mobile tweaks */
@media (max-width: 775px) {
  .ban-modal {
    max-width: 92%!important;
  }

  /* Hide nav items if they don’t fit */
  nav {
    display: none!important;
  }
}
.modal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.9);
  opacity: 0;
  z-index: 1000;
  transition: opacity 0.25s ease, transform 0.25s ease;
  pointer-events: none; /* Prevent clicking when hidden */
}

.modal.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
  pointer-events: auto;
  max-width: 100%;
}
.modal-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4);
  z-index: 999;
  opacity: 0;
  transition: opacity 0.25s ease;
  pointer-events: none;
}

.modal-backdrop.show {
  opacity: 1;
  pointer-events: auto;
}

header {
    position: fixed;
    box-sizing: border-box;
    top: 0;
    width: 100%;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 10px;
    background: #fff;
    color: #000;
    z-index: 500;
  }

  .left, .right {
    display: flex;
    align-items: center;
  }

  .left img {
    height: 32px;
    margin-right: 32px;
  }

  .left span {
    font-weight: bold;
    margin-right: 32px;
    font-size: 16px;
  }

  .left nav a {
    margin-right: 32px;
    text-decoration: none;
    color: inherit;
    font-size: 16px;
  }

  .right .user-circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: #eee;
    margin-right: 5px;
  }

  .right span, .right img {
    font-size: 16px;
    margin-left: 5px;
    margin-right: 10px;
  }

  .right img {
    width: 32px;
    height: 32px;
  }

  /* Dark mode */
  header.dark {
    background: #1F1F1F;
    color: #eee;
  }

  header.dark .left nav a {
    color: #eee;
  }

  header.dark .right .user-circle {
    background: #555;
  }
#sidebar {
  position: fixed;
  top: 44px; /* below header */
  left: 0;
  width: 160px;
  height: 100%;
  background: #fff;
  border-right: 1px solid #ddd;
  padding: 16px;
  box-sizing: border-box;
  font-size: 16px;
  display: none;
  flex-direction: column;
  gap: 12px;
  z-index: 900;
}

#sidebar a, #sidebar .premium-btn {
  display: block;
  text-decoration: none;
  color: #000;
  margin-bottom: 12px;
  font-size: 16px;
}

.premium-btn {
  margin-top: auto;
  padding: 8px;
  border: none;
  background: #ffd633;
  border-radius: 4px;
  cursor: pointer;
  font-weight: 600;
}

/* Dark mode */
header.dark + #sidebar {
  background: #1F1F1F;
  border-right: 1px solid #444;
}

header.dark + #sidebar a,
header.dark + #sidebar .premium-btn {
  color: #eee;
}

/* Hamburger icon */
#hamburger {
  display: none;
  font-size: 22px;
  cursor: pointer;
  margin-right: 12px;
}

/* Responsive */
@media (max-width: 1599px) {
  #sidebar {
    display: none;
  }
  #hamburger {
    display: block;
  }
}

@media (min-width: 1600px) {
  #sidebar {
    display: flex;
  }
}
#logo {
  content: url("boibylongdark.png");
  height: 36px; /* adjust as needed */
}

/* If .dark-mode is applied to body or header, swap to light logo */
.dark-mode #logo {
  content: url("boibylonglight.png");
}

            body.dark-mode {
        background-color: #111 !important;
    }

    body.dark-mode .modal {
        background: #1e1e1e !important;
        color: #eee !important;
    }

    body.dark-mode .modal-header h2,
    body.dark-mode .rules-broken,
    body.dark-mode .permanent-ban-message,
    body.dark-mode .latest-activity,
    body.dark-mode .violation-text,
    body.dark-mode #evidenceContainer p,
    body.dark-mode #evidenceContainer b {
        color: #eee !important;
    }
    
    body.dark-mode a:visited {
        text-decoration: none;
        color: #eee;
    }

    body.dark-mode .modal-button.logout-button,
    body.dark-mode .modal-button.rules-button,
    body.dark-mode .modal-button.appeal-button,
    body.dark-mode .modal-button.back-button {
        background-color: #2a2a2a !important;
        color: #eee !important;
    }

    body.dark-mode .reactivate-button:disabled,
    body.dark-mode .disabled-button {
        background-color: #333 !important;
        color: #999 !important;
    }
		body.dark-mode .evidence-container,
		body.dark-mode #evidenceContainer {
			background-color: #292929!important;
		}
		body.dark-mode .interventionId {
			color: #444!important;
    		font-weight: 400;
    		font-size: 14px;
    		margin-top: 6px;
		}
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f7f7f8;
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
        }
        
        .modal {
            width: 600px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 24px;
            box-sizing: border-box;
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 28px;
            margin-top: 8px;
            gap: 6px;
            position: relative;
        }
        
        .modal-header svg {
            width: 20px;
            height: 20px;
            fill: #d32f2f;
        }
        
        .permanent-ban-icon {
            width: 20px;
    height: 20px;
    fill: #d32f2f;
    margin-right: 3px;
        }
        
        .modal-header h2 {
            font-size: 21px;
            font-weight: 600;
            margin: 0;
            color: #212121;
        }
        
        .rules-broken {
            color: #212121;
            margin-bottom: 20px;
        }
        
        .permanent-ban-message {
            color: #212121;
            margin-bottom: 20px;
        }
        
        .latest-activity {
            font-weight: 600;
            margin-bottom: 12px;
            color: #212121;
        }
        
        .violation-box {
            border-bottom: 1px solid grey;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        
        .evidence-container {
    margin-bottom: 0;
  padding: 15px;
  background-color: #f5f5f5;
  box-shadow: 0px 0px 1px 1px #eee;
  border-radius: 8px;
        }
        .interventionId {
			color: #ddd;
    		font-weight: 400;
    		font-size: 14px;
    		margin-top: 6px;
		}
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
        }
        
        .modal-footer.left-align {
            justify-content: flex-start;
        }
        
        .modal-footer.dual-buttons {
            justify-content: space-between;
        }

		.modal-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4); 
  z-index: 999; 
}

.modal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 1000; /* sits above backdrop */
}

        .violation-text {
            font-weight: 600!important;
        }
        
        .modal-button {
                padding: 10px 16px;
    border-radius: 8px;
    font-weight: 525;
    cursor: pointer;
    border: none;
    font-size: 16px;
    text-decoration: none;
    display: inline-block;
        }
        
        .continue-button {
            background-color: #335fff;
            color: white;
        }
        
        .reactivate-button {
            background-color: #335fff;
            color: white;
        }
        
        .reactivate-button:disabled {
            background-color: #f5f5f5;
            color: #444;
            cursor: not-allowed;
        }
        
        .logout-button, .rules-button, .appeal-button, .back-button {
            background-color: #eee!important;
            color: #212121;
        }
        
        .permanent-appeal-button {
            background-color: #eee!important;
            color: #212121;
			padding: 8px 16px;
			border: none
        }
        
        .disabled-button {
            background-color: #f5f5f5;
            color: #9e9e9e;
            cursor: not-allowed;
        }
        
        #evidenceContainer p {
            margin: 0;
        }
        
        #evidenceContainer b {
            font-weight: 600;
            display: block;
            margin-top: 4px;
        }
		
        .appeal-content {
            display: none;
        }
        
        .appeal-content b {
            display: block;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        
        .appeal-content li {
            margin-bottom: 8px;
        }
        
        .agree-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 15px 0;
        }
        
        .reactivate-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }
        
        /* Three dots menu styles */
        .menu-dots {
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    font-size: 20px;
    padding: 5px;
    user-select: none;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    transition: background-color 0.2s;
}

.menu-dots:hover {
    background-color: #f0f0f0;
}

body.dark-mode .menu-dots:hover {
    background-color: #3a3a3a;
}
        
        .menu-dropdown {
    position: absolute;
    top: 100%; /* Position below the menu dots */
    right: 0;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    padding: 8px 0;
    display: none;
    z-index: 1010;
    min-width: 120px;
    margin-top: 5px; /* Add small gap from the dots */
}
        
        .menu-dropdown.show {
            display: block;
        }
        
        .menu-dropdown a {
            display: block;
            padding: 8px 16px;
            text-decoration: none;
            color: #212121;
            font-size: 14px;
        }
        
        .menu-dropdown a:hover {
            background-color: #f5f5f5;
        }
        
        body.dark-mode .menu-dropdown {
            background: #2a2a2a;
        }
        
        body.dark-mode .menu-dropdown a {
            color: #eee;
        }
        
        body.dark-mode .menu-dropdown a:hover {
            background-color: #3a3a3a;
        }
    </style>
	
</head>
<body>

	<header id="header">
  <div class="left">
    <div id="hamburger">☰</div>
    <img id="logo" src="boibylongdark.png" alt="Boiby Logo">
    <nav>
      <a href="#">Discover</a>
      <a href="#">Catalog</a>
      <a href="#">Develop</a>
      <a href="#">Boibucks</a>
    </nav>
  </div>

  <div class="right">
    <div class="user-circle"></div>
    <span id="username" style="font-weight:500;">f</span>
    <span> </span>
    <img src="bgreen.png" alt="Boibucks">
    <span>?</span>
  </div>
</header>
	<div id="sidebar">
        <a href="#">Home</a>
        <a href="#">Profile</a>
        <a href="#">Discover</a>
        <a href="#">Catalog</a>
        <a href="#">Acquaintances</a>
        <a href="#">Chat</a>
        <a href="#">Trade</a>
        <a href="#">Money</a>
        <a href="#">Develop</a>
        <a href="#">Premium</a>


  <button style="display:none" class="premium-btn">Get Premium</button>


</div>
	<div class="modal-backdrop"></div>	
    <div class="modal">
		<div class="div-outer-scroll-box">
        <div class="modal-header" id="modalHeader">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M12 5.99 19.53 19H4.47L12 5.99M12 2 1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"/>
            </svg>
            <h2 id="banHeader">Warning</h2>
            
            <!-- Three dots menu -->
            <div class="menu-dots" id="menuDots">⋮</div>
            <div class="menu-dropdown" id="menuDropdown">
                <a href="https://boibyban.github.io/login" id="dropdownLogout">Logout</a>
            </div>
        </div>
        
        <div id="mainContent">
            <p id="rulesMessage" class="rules-broken">Your behaviour broke the rules of Boiby.</p>
            
            <p class="latest-activity" id="latestActivity">Latest activity we reviewed</p>
            
            <div class="evidence-container">
                <div id="evidenceContainer">
					<div class="viewButtonContainer">
                <button style="
    width: 100%;
    height: 36px;
    border-radius: 8px;
    background-color: #e5e5e5;
    border: 0px;
    box-shadow: 0px 1px 1px 1px #ddd;
"><a id="viewMoreButton" style="
    text-align: center;
    width: fit-content;
    width: 100%;
    font-size: 16px;
    font-weight: 500;
">View more</a></button>
            </div>
				</div>
            </div>
			<p id="interventionIdItem" class="interventionId" style="
    color: #ddd;
    font-weight: 400;
    font-size: 15px;
    margin-top: 6px;
">22ceb0a8-83e2-400d-95e6-a0d92af3f402</p>
			<div class="mistake-box" style="display:none; margin-bottom:64px; margin-top:20px;">
    <b class="makeAMistake" style="padding-bottom: 12px;">
        Did we make a mistake?
    </b>
    <p class="makeAMistake" style="margin-top: 8px;">
        You can request an appeal or ask us to review this decision below.
    </p>
</div>
        </div>
        
        <div id="appealContent" class="appeal-content">
            <b>Rule violations add up</b>
            <ul>
                <li>We may give you a longer suspension - or even ban your account - if you keep breaking the rules.</li>
                <li>Make sure you know the rules and follow them.</li>
            </ul>
            
            <div class="modal-footer left-align">
                <a href="/info/community-rules" class="modal-button rules-button">View rules</a>
            </div>
            
            <b>Did we make a mistake?</b>
            <ul>
                <li>You can request an appeal or ask us to review this decision here:</li>
            </ul>
            
            <div class="modal-footer left-align">
                <a href="/report-mistake" class="modal-button appeal-button">Report a mistake</a>
            </div>
            
            <!-- Reactivate container only shown for warnings -->
            <div id="warningReactivateContainer" class="reactivate-container" style="display: none;">
                <div class="agree-checkbox">
                    <input type="checkbox" id="reactivateAgreeCheckbox">
                    <label for="reactivateAgreeCheckbox">I agree to know and follow the rules.</label>
                </div>
                <button id="reactivateAccountButton" class="modal-button reactivate-button" disabled>
                    Re-activate my account
                </button>
            </div>
        </div>
        
	</div>
		<div class="modal-footer" id="actionButtons" style="margin-top:12px">
            <button id="continueButton" class="modal-button continue-button">Continue</button>
        </div>
</div>

<script src="/translations-en.js"></script>
<script>
	
document.addEventListener('DOMContentLoaded', () => {
const modal = document.querySelector('.modal');
const backdrop = document.querySelector('.modal-backdrop');
			
document.addEventListener('click', function(e) {
    if (e.target.id === 'viewMoreButton' || e.target.parentElement.id === 'viewMoreButton') {
        e.preventDefault();
        // Simply redirect to report mistake page
        window.location.href = '#';
    }
});

document.addEventListener('click', function(e) {
    // Handle the "View more" toggle button
    if (e.target.classList.contains('view-toggle')) {
        e.preventDefault();
        
        const button = e.target;
        const evidenceItems = document.querySelectorAll('.evidence-content');
        const isExpanded = button.textContent.includes('View less');
        
        if (!isExpanded) {
            // Show all hidden items
            evidenceItems.forEach(item => {
                item.classList.remove('hidden');
                item.classList.add('visible');
            });
            button.textContent = 'View less';
        } else {
            // Hide items beyond the first 5
            evidenceItems.forEach((item, index) => {
                if (index >= 5) {
                    item.classList.remove('visible');
                    item.classList.add('hidden');
                }
            });
            // Update the count text
            const hiddenCount = evidenceItems.length - 5;
            button.textContent = `View more (${hiddenCount} more)`;
        }
    }
    
    // Keep your existing bottom button handler
    if (e.target.id === 'viewMoreButton' || e.target.parentElement.id === 'viewMoreButton') {
        e.preventDefault();
        window.location.href = '/report-mistake';
    }
});
  // Show modal on load
  setTimeout(() => {
    modal.classList.add('show');
    backdrop.classList.add('show');
  }, 50); // slight delay so CSS transition kicks in
});

function formatDate(dateInput) {
    let date;
    
    // First try to get banStartDate from form data
    const formData = JSON.parse(localStorage.getItem('banFormData'));
    if (formData && formData.banStartDate) {
        const [datePart, timePart] = formData.banStartDate.split(', ');
        const [day, month, year] = datePart.split('/');
        
        // Convert 12-hour format to 24-hour format for proper parsing
        let [time, modifier] = timePart.split(' ');
        let [hours, minutes, seconds] = time.split(':');
        
        if (modifier === 'PM' && hours !== '12') {
            hours = String(parseInt(hours, 10) + 12);
        } else if (modifier === 'AM' && hours === '12') {
            hours = '00';
        }
        
        // Create ISO format string for reliable parsing
        date = new Date(`${year}-${month}-${day}T${hours}:${minutes}:${seconds}`);
    }
    // If no banStartDate, handle various date input formats
    else if (typeof dateInput === 'string') {
        // Try to parse the date string from the form (DD/MM/YYYY, HH:MM:SS format)
        if (dateInput.includes('/') && dateInput.includes(',')) {
            const [datePart, timePart] = dateInput.split(', ');
            const [day, month, year] = datePart.split('/');
            date = new Date(`${year}-${month}-${day}T${timePart}`);
        } 
        // Try to parse ISO format or other date strings
        else {
            date = new Date(dateInput);
        }
    } else if (dateInput instanceof Date && !isNaN(dateInput.getTime())) {
        date = dateInput;
    } else {
        // Fallback to current date if invalid
        date = new Date();
    }

    // Check if the date is valid
    if (isNaN(date.getTime())) {
        // If invalid, use current date as fallback
        date = new Date();
    }

    // Format to "September 26 2025 at 1:55 PM"
    const options = {
        month: 'long',
        day: 'numeric',
        year: 'numeric'
    };
    
    const dateStr = date.toLocaleDateString('en-US', options);
    
    // Format time to 12-hour format without leading zeros
    let hours = date.getHours();
    const minutes = date.getMinutes();
    const ampm = hours >= 12 ? 'PM' : 'AM';
    
    hours = hours % 12;
    hours = hours ? hours : 12; // Convert 0 to 12
    
    const timeStr = `${hours}:${minutes.toString().padStart(2, '0')} ${ampm}`;
    
    return `${dateStr} at ${timeStr}`;
}
function setTheme(theme) {
	const themeStylesheet = document.getElementById('themeStylesheet');
	themeStylesheet.href = theme === "dark" ? "/ban-new-dark.css" : "/ban-new.css";

	//  set dark-mode class
	if (theme === "dark") {
		document.body.classList.add('dark-mode');
	} else {
		document.body.classList.remove('dark-mode');
	}
}

function showAppealContent() {
	document.getElementById('modalHeader').style.display = 'none';
	document.getElementById('mainContent').style.display = 'none';
	document.getElementById('appealContent').style.display = 'block';

	const formData = JSON.parse(localStorage.getItem('banFormData'));
	const actionButtons = document.getElementById('actionButtons');

	if (formData && formData.state === "Warn") {
		// Warnings show reactivation flow
		document.getElementById('warningReactivateContainer').style.display = 'block';
		document.getElementById('reactivateAgreeCheckbox').addEventListener('change', function() {
			document.getElementById('reactivateAccountButton').disabled = !this.checked;
		});
		document.getElementById('reactivateAccountButton').addEventListener('click', function() {
			window.location.href = "https://boibyban.github.io";
		});
	}

	actionButtons.className = 'modal-footer dual-buttons';

	if (formData && formData.state !== "Warn" && formData.state !== "Delete") {
		const suspensionButton = document.createElement('button');
		suspensionButton.className = 'modal-button disabled-button';
		suspensionButton.innerHTML = `
		    <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
		        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
		    </svg>
		    <span class="suspension-text">Suspension</span> ...
		`;
		actionButtons.innerHTML = `
        <button id="backButton" class="modal-button back-button">Back</button>
    `;
		actionButtons.appendChild(suspensionButton);

		const stateDurations = {
			Ban1Hour: 1 * 60 * 60 * 1000,
			Ban3Hours: 3 * 60 * 60 * 1000,
			Ban6Hours: 6 * 60 * 60 * 1000,
			Ban12Hours: 12 * 60 * 60 * 1000,
			Ban1Day: 24 * 60 * 60 * 1000,
			Ban2Days: 2 * 24 * 60 * 60 * 1000,
			Ban3Days: 3 * 24 * 60 * 60 * 1000,
			Ban7Days: 7 * 24 * 60 * 60 * 1000,
			Ban14Days: 14 * 24 * 60 * 60 * 1000,
			Ban60Days: 60 * 24 * 60 * 60 * 1000,
			Ban6Months: 182 * 24 * 60 * 60 * 1000,
			Ban1Year: 365 * 24 * 60 * 60 * 1000
		};

		let banStartDate;
		if (formData.banStartDate) {
			const [datePart, timePart] = formData.banStartDate.split(', ');
			const [day, month, year] = datePart.split('/');
			banStartDate = new Date(`${month}/${day}/${year} ${timePart}`);
		} else {
			banStartDate = new Date();
		}

		const endTime = new Date(banStartDate.getTime() + (stateDurations[formData.state] || 0));

		function updateCountdown() {
		    const now = new Date();
		    let diff = endTime - now;
		
		    if (diff <= 0) {
		        suspensionButton.innerHTML = `
		            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
		                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
		            </svg>
		            <span class="suspension-text">Reactivate Account</span>
		        `;
		        suspensionButton.classList.remove('disabled-button');
		        suspensionButton.classList.add('reactivate-button');
		        suspensionButton.disabled = false;
		        suspensionButton.addEventListener('click', function() {
		            window.location.href = "https://boibyban.github.io";
		        });
		        return;
		    }
		
		    // Calculate time components
		    const totalHours = Math.floor(diff / (1000 * 60 * 60));
		    const days = Math.floor(totalHours / 24);
		    const hours = totalHours % 24;
		    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
		
		    // Format time based on duration - show days for > 2 days, HH:MM for ≤ 2 days
		    let timeText;
		    if (totalHours > 48) { // More than 2 days (48 hours)
		        // Round to nearest day
		        const roundedDays = Math.round(totalHours / 24);
		        timeText = `${roundedDays} day${roundedDays !== 1 ? 's' : ''}`;
		    } else {
		        // Show HH:MM format for 2 days or less
		        timeText = `${String(totalHours).padStart(2, '0')}:${String(minutes).padStart(2, '0')} hours`;
		    }
		
		    suspensionButton.innerHTML = `
		        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
		            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
		        </svg>
		        <span class="suspension-text">Suspension</span> ${timeText}
		    `;
		    
		    setTimeout(updateCountdown, 60000);
		}
		updateCountdown();
	}
else if (formData && formData.state === "Delete") {
	// Permanent ban
	actionButtons.innerHTML = `
            <button id="backButton" class="modal-button back-button">Back</button>
            <button class="modal-button disabled-button">Suspended</button>
        `;
} else {
	// Warn
	actionButtons.innerHTML = `
            <button id="backButton" class="modal-button back-button">Back</button>
        `;
}
document.getElementById('backButton').addEventListener('click', function() {
	document.getElementById('modalHeader').style.display = 'flex';
	document.getElementById('mainContent').style.display = 'block';
	document.getElementById('appealContent').style.display = 'none';
	resetActionButtons();
});
}


function resetActionButtons() {
	const actionButtons = document.getElementById('actionButtons');
	actionButtons.className = 'modal-footer';

	const formData = JSON.parse(localStorage.getItem('banFormData'));
	if (formData && formData.state === "Delete") {
		actionButtons.innerHTML = `
                    <a href="/report-mistake" class="modal-button logout-button">Report a mistake</a>
                `;
	} else {
		actionButtons.innerHTML = `
                    <button id="continueButton" class="modal-button continue-button">Continue</button>
                `;

		// Reattach continue button event
		document.getElementById('continueButton').addEventListener('click', showAppealContent);
	}
}

// Three dots menu functionality
function setupMenuDots() {
    const menuDots = document.getElementById('menuDots');
    const menuDropdown = document.getElementById('menuDropdown');
    
    menuDots.addEventListener('click', function(e) {
        e.stopPropagation();
        menuDropdown.classList.toggle('show');
    });
    
    // Close dropdown when clicking elsewhere
    document.addEventListener('click', function(e) {
        if (!menuDots.contains(e.target) && !menuDropdown.contains(e.target)) {
            menuDropdown.classList.remove('show');
        }
    });
}

document.addEventListener('DOMContentLoaded', function() {
    setupMenuDots();
    
	const formData = JSON.parse(localStorage.getItem('banFormData'));
	const language = localStorage.getItem('language') || 'en';
	const savedTheme = localStorage.getItem('theme') || "light";

	setTheme(savedTheme);

	// Set header text based on ban type
	const headerMap = {
		Warn: translations[language]["Heading.Warn"],
		Ban1Hour: translations[language]["Heading.Suspend1Hour"],
		Ban3Hours: translations[language]["Heading.Suspend3Hours"],
		Ban6Hours: translations[language]["Heading.Suspend6Hours"],
		Ban12Hours: translations[language]["Heading.Suspend12Hours"],
		Ban1Day: translations[language]["Heading.Suspend1Day"],
		Ban2Days: translations[language]["Heading.Suspend2Days"],
		Ban3Days: translations[language]["Heading.Suspend3Days"],
		Ban7Days: translations[language]["Heading.Suspend7Days"],
		Ban14Days: translations[language]["Heading.Suspend14Days"],
		Ban60Days: translations[language]["Heading.Suspend60Days"],
		Ban6Months: translations[language]["Heading.Suspend6Months"],
		Ban1Year: translations[language]["Heading.Suspend1Year"],
		Delete: translations[language]["Heading.Banned"],
	};

	
	if (formData && formData.state) {
		document.getElementById('banHeader').textContent = headerMap[formData.state] || translations[language]["Heading.Warn"];

		// Handle rules message based on ban type and violations
		const rulesMessageEl = document.getElementById('rulesMessage');
		const isPermanentBan = formData.state === "Delete";

		if (isPermanentBan) {
			rulesMessageEl.className = 'permanent-ban-message';
			rulesMessageEl.textContent =
				'We banned your account because of repeated or serious rule-breaking.';

			document.querySelector('.mistake-box').style.display = 'none';

			const evidenceContainer = document.querySelector('.evidence-container');
			
			// Replace warning icon with permanent ban icon
			const header = document.getElementById('modalHeader');
			const existingIcon = header.querySelector('svg');
			if (existingIcon) {
				existingIcon.remove();
			}
			const banIcon = document.createElement('svg');
			banIcon.className = 'permanent-ban-icon';
			banIcon.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
			banIcon.setAttribute('viewBox', '0 0 24 24');
			banIcon.innerHTML = '<img class="permanent-ban-icon" src="https://upload.wikimedia.org/wikipedia/commons/d/d5/No_sign.svg" alt="Permanent Ban">';
			header.insertBefore(banIcon, header.firstChild);

			// Replace continue button with appeal button
			const continueBtn = document.getElementById('continueButton');
			if (continueBtn) {
				continueBtn.remove();
			}
			const appealBtn = document.createElement('a');
			appealBtn.href = '/report-mistake';
			appealBtn.className = 'modal-button permanent-appeal-button';
			appealBtn.textContent = translations[language]["Action.ReportAMistake"] || "Report a mistake";
			document.getElementById('actionButtons').prepend(appealBtn);
		}
		else {
		    // Handle temp suspension messages
		    const hasViolations = formData.classicViolations && formData.classicViolations.length > 0;
		    const firstViolation = hasViolations ? formData.classicViolations[0] : null;
		
		    if (!hasViolations || !firstViolation?.reason) {
		        rulesMessageEl.textContent = 'Your behaviour broke the Boiby Community Rules.';
			} else {
	        const violationType = firstViolation.violationType || '';
	        const reason = firstViolation.reason; // Keep original case
	
	        if (violationType === "General/Chat") {
	            rulesMessageEl.textContent = `Your behaviour broke the rules regarding: ${reason}`;
	        } else {
	            // Define which violation types should keep their original case and shouldn't be pluralized
	            const nonPluralTypes = [
	                "Profile Picture", "Display Name", "Username", 
	                "User Profile About", "Voice Chat"
	            ];
	            
	            const preserveCaseTypes = [
	                "UGC Bundle", "UGC Accessory"
	            ];
	            
	            let violationTypeDisplay = preserveCaseTypes.includes(violationType) 
	                ? violationType 
	                : violationType.toLowerCase();
	            
	            if (nonPluralTypes.includes(violationType)) {
	                rulesMessageEl.textContent = `Your ${violationTypeDisplay} broke the rules regarding: ${reason}`;
	            } else {
	                rulesMessageEl.textContent = `One of your ${violationTypeDisplay}s broke the rules regarding: ${reason}`;
	            }
	        }
	    }
	}
}
	// Set the intervention ID from localStorage
	const caseID = localStorage.getItem('ModPanelCaseID');
	if (caseID) {
    	document.getElementById('interventionIdItem').textContent = caseID;
	}		

	// Set latest activity label
	document.getElementById('latestActivity').textContent = translations[language]["Label.LatestActivity"];

	// Set up continue button - always says "Continue" on first screen
	const continueBtn = document.getElementById('continueButton');
	if (continueBtn) {
		continueBtn.textContent = "Continue";
		continueBtn.addEventListener('click', showAppealContent);
	}

if (formData) {
    const reviewedDate = formData.banStartDate ? formatDate(formData.banStartDate) : formatDate(new Date());
    const moderatorNote = formData.customNote || (formData.note === "nonote" ? "" : formData.note) || "";

    // Clear and set up evidence container
    const evidenceContainerEl = document.querySelector('.evidence-container');
    
    // Start with an empty container
    evidenceContainerEl.innerHTML = '';
    
    let hasImageViolation = false;
    let imageHTML = "";
    let violationHTML = '';
    
    // Process modern violations first (if they exist), otherwise process classic violations
    if (formData.modernViolations && formData.modernViolations.length > 0) {
        // Only show the first modern violation
        const violation = formData.modernViolations[0];
        
        // Check if this is an image violation
        const classicViolation = formData.classicViolations && formData.classicViolations.length > 0 
            ? formData.classicViolations.find(cv => cv.reason === violation.reason) 
            : null;
            
        const isImageViolation = classicViolation && classicViolation.evidence && 
                               (classicViolation.violationType === "Image" || classicViolation.violationType === "Profile Picture") &&
                               classicViolation.evidence.startsWith("data:image");
        
        if (isImageViolation) {
            hasImageViolation = true;
            imageHTML = `
                <div class="evidence-image" style="max-width:180px; max-height:400px; height:fit-content; border-radius:8px; position:absolute; left:15px; align-items: center;">
                    <img src="${classicViolation.evidence}" alt="Violating Image" style="max-width:180px; max-height:400px; border-radius: 8px; align-self: center; margin: auto;">
                </div>
            `;
        }
        
        // Build violation HTML - this will be added FIRST
        violationHTML += '<div class="violation-box">';
        violationHTML += `
            <p>${translations[language]["Label.Reason"]}:<b class="violation-text" style="display:block;margin-top:4px">${violation.reason}</b></p>
        `;
        
        // Handle different violation types
        switch(violation.violationType) {
            case "UGC Bundle":
                violationHTML += `
                    <p style="margin-bottom: 4px;">${translations[language]["Label.BundleName"]}:</p>
                    <div class="offensive-items-container" style="margin-bottom:4px;">
                        <b class="evidence-content visible" data-index="0">${classicViolation ? classicViolation.evidence : 'N/A'}</b>
                    </div>
                    <p style="margin-top: 12px; margin-bottom:4px;">${translations[language]["Label.BundleID"]}:</p>
                    <div class="offensive-items-container" style="margin-bottom:4px;">
                        <b class="evidence-content visible" data-index="0">${violation.assetId || 'N/A'}</b>
                    </div>
                `;
                break;
                
            case "Image":
            case "Profile Picture":  // Profile Picture treated like Image
                violationHTML += `
                    <p style="margin-bottom: 4px;">${translations[language]["Label.AssetID"]}:</p>
                    <div class="offensive-items-container" style="margin-bottom:4px;">
                        <b class="evidence-content visible" data-index="0">${violation.assetId || 'N/A'}</b>
                    </div>
                `;
                break;
                
            case "Voice Chat":  // Voice Chat with Location field
                violationHTML += `
                    <p style="margin-bottom: 4px;">${translations[language]["Label.Location"] || "Location"}:</p>
                    <div class="offensive-items-container" style="margin-bottom:4px;">
                        <b class="evidence-content visible" data-index="0">${violation.location || 'N/A'}</b>
                    </div>
                `;
                break;
                
            case "Model":
                violationHTML += `
                    <p style="margin-bottom: 4px;">${translations[language]["Label.ModelName"]}:</p>
                    <div class="offensive-items-container" style="margin-bottom:4px;">
                        <b class="evidence-content visible" data-index="0">${classicViolation ? classicViolation.evidence : 'N/A'}</b>
                    </div>
                    <p style="margin-top: 12px; margin-bottom:4px;">${translations[language]["Label.AssetID"]}:</p>
                    <div class="offensive-items-container" style="margin-bottom:4px;">
                        <b class="evidence-content visible" data-index="0">${violation.assetId || 'N/A'}</b>
                    </div>
                `;
                break;
                
            case "Accessory":
                violationHTML += `
                    <p style="margin-bottom: 4px;">${translations[language]["Label.AccessoryName"]}:</p>
                    <div class="offensive-items-container" style="margin-bottom:4px;">
                        <b class="evidence-content visible" data-index="0">${classicViolation ? classicViolation.evidence : 'N/A'}</b>
                    </div>
                    <p style="margin-top: 12px; margin-bottom:4px;">${translations[language]["Label.AssetID"]}:</p>
                    <div class="offensive-items-container" style="margin-bottom:4px;">
                        <b class="evidence-content visible" data-index="0">${violation.assetId || 'N/A'}</b>
                    </div>
                `;
                break;
                
            default:
                // Fallback for other violation types
                violationHTML += `
                    <p style="margin-bottom: 4px;">${translations[language]["Label.OffensiveItemV2"]}:</p>
                    <div class="offensive-items-container" style="margin-top:4px;">
                        <b class="evidence-content visible" data-index="0">
                            ${violation.violationType}: ${classicViolation ? classicViolation.evidence : 'N/A'}
                        </b>
                    </div>
                `;
        }
        
        violationHTML += '</div>';
    } 
    // If no modern violations, process classic violations
else if (formData.classicViolations && formData.classicViolations.length > 0) {
    // Group all violations under a single reason header
    violationHTML = '<div class="violation-box">';
    
    // Get all unique reasons
    const allReasons = [...new Set(formData.classicViolations.map(v => v.reason))];
    const reasonsText = allReasons.join(', ');
    
    violationHTML += `
        <p>${translations[language]["Label.Reason"]}:<b class="violation-text" style="display:block;margin-top:4px">${reasonsText}</b></p>
    `;
    
    // Check if there are any image violations
    const hasImageViolation = formData.classicViolations.some(violation => 
        (violation.violationType === "Image" || violation.violationType === "Profile Picture") && 
        violation.evidence && 
        violation.evidence.startsWith("data:image")
    );
    
    if (hasImageViolation) {
        const firstImageViolation = formData.classicViolations.find(violation => 
            (violation.violationType === "Image" || violation.violationType === "Profile Picture") && 
            violation.evidence && 
            violation.evidence.startsWith("data:image")
        );
        
        const assetId = Math.floor(1e14 + Math.random() * 9e14);
        imageHTML = `
            <div class="evidence-image" style="max-width:180px; max-height:400px; height:fit-content; border-radius:8px; position:absolute; left:15px; align-items: center;">
                <img src="${firstImageViolation.evidence}" alt="Violating Image" style="max-width:180px; max-height:400px; border-radius: 8px; align-self: center; margin: auto;">
            </div>
        `;
        violationHTML += `
            <p>${translations[language]["Label.AssetID"]}:<b class="evidence-content" style="display:block;margin-top:4px">${assetId}</b></p>
        `;
    } 
    // Check for Voice Chat violations
    else if (formData.classicViolations.some(v => v.violationType === "Voice Chat")) {
        const voiceChatViolation = formData.classicViolations.find(v => v.violationType === "Voice Chat");
        violationHTML += `
            <p>${translations[language]["Label.Location"] || "Location"}:<b class="evidence-content" style="display:block;margin-top:4px">${voiceChatViolation.location || 'N/A'}</b></p>
        `;
    } 
    // Handle all other violations
    else {
        violationHTML += `
            <p style="margin-bottom: 4px;">${translations[language]["Label.OffensiveItemV2"]}:
                <div class="offensive-items-container" style="margin-top:4px;">
        `;
        
        // Add all evidence items
        formData.classicViolations.forEach((violation, index) => {
            const evidenceContent = violation.violationType !== "General/Chat" 
                ? `${violation.violationType}: ${violation.evidence}`
                : violation.evidence;
            
            const isHidden = index >= 5;
            violationHTML += `
                <b class="evidence-content ${isHidden ? 'hidden' : 'visible'}" 
                   data-index="${index}">
                   ${evidenceContent}
                </b>
            `;
        });
        
        violationHTML += `</div>`;
        
        // Add view more/less toggle if there are more than 5 items
        if (formData.classicViolations.length > 5) {
            violationHTML += `
                <div class="view-toggle" data-reason="all-violations" style="margin-top:8px;">
                    View more (${formData.classicViolations.length - 5} more)
                </div>
            `;
        }
        
        violationHTML += `</p>`;
    }
    
    violationHTML += '</div>';
}
    
    // Create evidence container HTML (review date and moderator note)
    let evidenceHTML = `
        <div id="evidenceContainer">
            <div style="margin-bottom: 16px;">
                <p>${translations[language]["Label.ReviewDateV2"]}:<b id="reviewedDate">${reviewedDate}</b></p>
            </div>
    `;

    if (moderatorNote) {
        evidenceHTML += `
            <div style="margin-bottom: 16px;">
                <p>${translations[language]["Label.ModeratorNoteV2"]}:<b id="moderatorNote">${moderatorNote}</b></p>
            </div>
        `;
    }
    
    evidenceHTML += `</div>`;
    
    // Add violation box FIRST, then evidence container
    evidenceContainerEl.innerHTML = violationHTML + evidenceHTML;
    
    // If image violation, add image and set up layout
    if (hasImageViolation) {
        evidenceContainerEl.style.position = "relative";
        evidenceContainerEl.insertAdjacentHTML("afterbegin", imageHTML);
        
        function updateLayout() {
            if (window.innerWidth >= 600) {
                // Move evidenceContainer and violation box 200px to the left
                const evidenceContainerDiv = document.getElementById('evidenceContainer');
                const violationBoxEl = document.querySelector('.violation-box');
                
                evidenceContainerDiv.style.position = "relative";
                evidenceContainerDiv.style.left = "200px";
                evidenceContainerDiv.style.maxWidth = "320px";
                
                if (violationBoxEl) {
                    violationBoxEl.style.position = "relative";
                    violationBoxEl.style.left = "200px";
                    violationBoxEl.style.maxWidth = "320px";
                }
            } else {
                // Reset for mobile
                const evidenceContainerDiv = document.getElementById('evidenceContainer');
                const violationBoxEl = document.querySelector('.violation-box');
                
                evidenceContainerDiv.style.left = "0";
                evidenceContainerDiv.style.maxWidth = "100%";
                
                if (violationBoxEl) {
                    violationBoxEl.style.left = "0";
                    violationBoxEl.style.maxWidth = "100%";
                }
                
                const imgEl = evidenceContainerEl.querySelector('.evidence-image');
                if (imgEl) {
                    imgEl.style.position = "relative";
                    imgEl.style.left = "0";
                    imgEl.style.marginBottom = "15px";
                }
            }
        }

        window.addEventListener('resize', updateLayout);
        updateLayout();
    }
    
    // Add the single view button at the end
    const buttonHTML = `
        <div class="viewButtonContainer" style="margin-top: 16px;">
            <button style="width: 100%; height: 36px; border-radius: 8px; background-color: #e5e5e5; border: 0px; box-shadow: 0px 1px 1px 1px #ddd;">
                <a id="viewMoreButton" style="text-align: center; width: 100%; font-size: 16px; font-weight: 500; display: block;">View more</a>
            </button>
        </div>
    `;
    evidenceContainerEl.innerHTML += buttonHTML;
    // Hide items beyond the first 5 initially
document.querySelectorAll('.evidence-content').forEach((item, index) => {
    if (index >= 5) {
        item.classList.remove('visible');
        item.classList.add('hidden');
    }
});

// Update view more button text if there are more than 5 items
const evidenceItems = document.querySelectorAll('.evidence-content');
document.getElementById('viewMoreButton').textContent = 'View more';

        // If image violation, handle layout positioning
        if (hasImageViolation) {
            evidenceContainerEl.style.position = "relative";
            evidenceContainerEl.insertAdjacentHTML("afterbegin", imageHTML);
            
            function updateLayout() {
                if (window.innerWidth >= 600) {
                    // Move evidenceContainer and violation box 200px to the left
                    const evidenceContainerDiv = document.getElementById('evidenceContainer');
                    const violationBoxEl = document.querySelector('.violation-box');
                    
                    evidenceContainerDiv.style.position = "relative";
                    evidenceContainerDiv.style.left = "200px";
                    evidenceContainerDiv.style.maxWidth = "320px";
                    
                    if (violationBoxEl) {
                        violationBoxEl.style.position = "relative";
                        violationBoxEl.style.left = "200px";
                        violationBoxEl.style.maxWidth = "320px";
                    }
                } else {
                    // Reset for mobile
                    const evidenceContainerDiv = document.getElementById('evidenceContainer');
                    const violationBoxEl = document.querySelector('.violation-box');
                    
                    evidenceContainerDiv.style.left = "0";
                    evidenceContainerDiv.style.maxWidth = "100%";
                    
                    if (violationBoxEl) {
                        violationBoxEl.style.left = "0";
                        violationBoxEl.style.maxWidth = "100%";
                    }
                    
                    const imgEl = evidenceContainerEl.querySelector('.evidence-image');
                    if (imgEl) {
                        imgEl.style.position = "relative";
                        imgEl.style.left = "0";
                        imgEl.style.marginBottom = "15px";
                    }
                }
            }

            window.addEventListener('resize', updateLayout);
            updateLayout();
        }
    }
});
    </script>
	    <script src="/userHandling.js"></script>
	<script>
document.addEventListener("DOMContentLoaded", () => {
  function logout() {
    localStorage.removeItem("username");
    localStorage.removeItem("ModPanelUsername");
    localStorage.removeItem("banFormData");
    localStorage.setItem("logoutTime", new Date().toISOString());
    // Redirect to login
    window.location.href = "/login";
  }

  // Attach to all known logout triggers
  const logoutSelectors = [
    ".logout",
    ".logoutlink",
    "#dropdownLogout",
    "button.logout",
    "a.logout"
  ];

  logoutSelectors.forEach(selector => {
    document.querySelectorAll(selector).forEach(el => {
      el.addEventListener("click", e => {
        e.preventDefault();
        logout();
      });
    });
  });
});
</script>

</body>
	
</html>
