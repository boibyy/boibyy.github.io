<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Buy BoibyBook Air</title>
  <style>
    :root {
      --blue: #0071e3;
      --border: #d2d2d7;
      --text: #1d1d1f;
      --muted: #6e6e73;
      --bg: #fff;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      transition: opacity 0.3s ease;
    }

    body.fade-out {
      opacity: 0.5;
    }

    header {
      text-align: center;
      padding: 28px 16px;
      border-bottom: 1px solid var(--border);
      transition: all 0.3s ease;
    }
    
    h1 {
      font-size: 1.9rem;
      margin: 0;
      font-weight: 700;
    }

    .tabs {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 20px 0;
      transition: opacity 0.3s ease;
    }
    
    .tab {
      padding: 10px 22px;
      border: 1px solid var(--border);
      border-radius: 999px;
      cursor: pointer;
      transition: all .15s;
    }
    
    .tab.active {
      background: var(--blue);
      color: #fff;
      border-color: var(--blue);
    }

    .models, .configurator, .confirmation {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
    }
    
    .models {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 25px;
    }
    
    .card {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      background: #fff;
      transition: box-shadow .15s, transform .06s;
      display: flex;
      flex-direction: column;
    }
    
    .card:hover {
      border-color: var(--blue);
      transform: translateY(-2px);
    }
    
    .card-content {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .card-image {
      width: 140px;
      height: 140px;
      border-radius: 8px;
      overflow: hidden;
      background: #f5f5f7;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .card-image img {
      max-width: 100%;
      max-height: 100%;
      transition: opacity 0.3s ease;
    }
    
    .card-details {
      flex: 1;
    }
    
    .card h2 {
      font-size: 1.3rem;
      margin: 0 0 6px;
      font-weight: 600;
    }
    
    .price {
      font-size: 1.05rem;
      font-weight: 500;
      margin: 6px 0 12px;
      color: var(--muted);
    }
    
    .card ul {
      margin: 0;
      padding-left: 20px;
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    .color-selector {
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }
    
    .color-pill {
      padding: 6px 12px;
      border: 1px solid var(--border);
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
    }
    
    .color-pill.selected {
      background: var(--blue);
      color: #fff;
      border-color: var(--blue);
    }
    
    .select-btn {
      margin-top: auto;
      padding: 10px 0;
      background: var(--blue);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background .2s;
    }
    
    .select-btn:hover {
      background: #005bb5;
    }

    .back-btn {
      margin: 10px 0 20px;
      padding: 8px 18px;
      background: #f5f5f7;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.95rem;
    }
    
    .back-btn:hover { 
      background: #e6e6e9; 
    }

    .hero { 
      margin-bottom: 24px; 
    }
    
    .hero-title {
      font-size: clamp(1.8rem, 4vw, 2.4rem);
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1.2;
      margin: 0 0 12px;
    }
    
    .hero-content {
      display: flex;
      gap: 30px;
      align-items: flex-start;
    }
    
    .hero-image {
      width: 280px;
      flex-shrink: 0;
      border-radius: 0;
      overflow: hidden;
    }
    
    .hero-image img {
      width: 100%;
      display: block;
      transition: opacity 0.3s ease;
    }
    
    .hero-list {
      list-style: none;
      padding: 0;
      margin: 0;
      color: var(--muted);
      flex: 1;
    }
    
    .hero-list li {
      font-size: 1rem;
      line-height: 1.6;
      margin: 6px 0;
    }

    .group { 
      margin: 24px 0; 
      position: relative;
    }
    
    .group h3 {
      font-size: 1.1rem;
      margin: 0 0 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .info-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--muted);
      color: white;
      font-size: 12px;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .info-icon:hover {
      background: var(--blue);
    }

    .pill {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 28px 20px;
      border: 1px solid var(--border);
      border-radius: 12px;
      margin: 10px 0;
      cursor: pointer;
      background: #fff;
      transition: border-color .12s, box-shadow .12s, transform .06s;
    }
    
    .pill:hover { 
      border-color: var(--blue); 
      transform: translateY(-2px); 
    }
    
    .pill.selected {
      border: 2px solid var(--blue);
      box-shadow: 0 4px 14px rgba(0,113,227,0.08);
    }
    
    .pill.disabled {
      opacity: .6;
      cursor: not-allowed;
      background: #fbfbfb;
    }
    
    .pill .label { 
      font-weight: 600; 
    }
    
    .pill .price-right { 
      color: var(--muted); 
      font-weight: 600; 
      white-space: nowrap; 
    }

    .note {
      font-size: .9rem;
      color: var(--muted);
      margin-top: 6px;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .modal-overlay.visible {
      opacity: 1;
      visibility: visible;
    }
    
    .modal {
      background: white;
      border-radius: 16px;
      padding: 24px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }
    
    .modal-overlay.visible .modal {
      transform: translateY(0);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .modal-title {
      font-size: 1.4rem;
      font-weight: 600;
      margin: 0;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--muted);
    }
    
    .modal-content {
      line-height: 1.6;
    }
    
    .modal-content p {
      margin: 0 0 16px;
    }
    
    .modal-content ul {
      margin: 0 0 16px;
      padding-left: 20px;
    }

    .checkout {
      position: sticky;
      bottom: 0;
      left: 0;
      right: 0;
      width: auto;
      max-width: 100vw;
      box-sizing: border-box;
      background: #fff;
      border-top: 1px solid var(--border);
      padding: 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
      z-index: 100;
      overflow-x: hidden;
    }
    
    .total {
      font-size: 1.4rem;
      font-weight: 700;
    }
    
    .add-to-bag {
      padding: 12px 22px;
      font-size: 1.05rem;
      background: var(--blue);
      color: #fff;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      transition: background .2s;
    }
    
    .add-to-bag:hover { 
      background: #005bb5; 
    }

    .confirmation {
      text-align: center;
      display: none;
    }
    
    .confirmation-image {
      width: 300px;
      margin: 0 auto 20px;
      border-radius: 12px;
      overflow: hidden;
    }
    
    .confirmation-image img {
      width: 100%;
    }
    
    .confirmation-details {
      max-width: 600px;
      margin: 0 auto;
      text-align: left;
      background: #f9f9f9;
      padding: 20px;
      border-radius: 12px;
    }
    
    .confirmation-title {
      font-size: 2.2rem;
      margin-bottom: 10px;
      color: #0071e3;
    }
    
    .confirmation-model {
      font-size: 1.4rem;
      margin-bottom: 20px;
    }
    
    .confirmation-list {
      list-style: none;
      padding: 0;
      margin: 0 0 20px;
    }
    
    .confirmation-list li {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    
    .confirmation-total {
      font-size: 1.6rem;
      font-weight: 700;
      text-align: center;
      margin-top: 20px;
    }

    @media (max-width: 900px) {
      .models {
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      }
      
      .hero-content {
        flex-direction: column;
      }
      
      .hero-image {
        width: 100%;
        max-width: 300px;
        margin: 0 auto;
      }
    }

    @media (max-width: 600px) {
      .pill { 
        padding: 14px; 
      }
      
      .checkout {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
      }
      
      .add-to-bag { 
        width: 100%; 
      }
      
      .card-content {
        flex-direction: column;
      }
      
      .card-image {
        width: 100%;
        height: 180px;
        margin-bottom: 15px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1 id="headerTitle">Buy BoibyBook Air</h1>
  </header>

  <div class="tabs" id="sizeTabs">
    <div class="tab active" data-size="13">13-inch</div>
    <div class="tab" data-size="15">15-inch</div>
  </div>

  <main>
    <div class="models" id="models"><!-- cards inserted by JS --></div>

    <div class="configurator" id="configurator" style="display:none;">
      <button class="back-btn" id="backBtn">← Back</button>
      <div class="hero">
        <h2 class="hero-title" id="heroTitle"></h2>
        <div class="hero-content">
          <div class="hero-image" id="heroImage"></div>
          <ul class="hero-list" id="heroList"></ul>
        </div>
      </div>
      <div id="options"></div>
    </div>

    <div class="confirmation" id="confirmation">
      <h2 class="confirmation-title">Order Confirmed!</h2>
      <div class="confirmation-image" id="confirmationImage"></div>
      <h3 class="confirmation-model" id="confirmationModel"></h3>
      <div class="confirmation-details">
        <h4>Order Summary:</h4>
        <ul class="confirmation-list" id="confirmationList"></ul>
        <div class="confirmation-total" id="confirmationTotal"></div>
      </div>
      <button class="back-btn" id="confirmationBackBtn" style="margin-top: 30px;">← Back to Store</button>
    </div>
  </main>

  <div class="modal-overlay" id="memoryModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Memory Guide</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-content">
        <p><strong>How much memory is right for you?</strong></p>
        <p>Our unified memory architecture allows the CPU and GPU to access the same memory pool, improving performance and efficiency. Here is a general guide to how much you might need:</p>
        
        <p><strong>16 GB:</strong> Good for general users, students, and users with standard workloads. This configuration is ideal for those who primarily browse the web, stream content, use productivity apps, do light video and photo editing, and perform multitasking</p>
        
        <p><strong>24 GB:</strong> Good for users who need slightly more headroom for multitasking and moderate creative work. Ideal for those who do light to moderate video editing, gaming, graphic design, or programming, but don't push those to the extreme. Good for users who run multiple intensive apps simultaneously and perform more multitasking.</p>
        
        <p><strong>32 GB:</strong> Best for users engaging in more intensive workflows, such as video editing in 4K, music production with multiple tracks, large-scale coding projects, working with 3D models, playing memory-intensive simulator games, or using virtual machines.</p>
      </div>
    </div>
  </div>

  <div class="checkout" id="checkout">
    <div class="total" id="finalPrice">Total: $0</div>
    <button class="add-to-bag" id="addToBagBtn">Add to Bag</button>
  </div>

  <script>
    (function () {
      const sizes = ['13','15'];
      const colors = ['Silver', 'Midnight', 'Gold', 'Blue'];
      let selectedColor = 'Silver';

      const template13 = {
        "B5": {
          price: 1599,
          display: "13.7-inch IPS 120Hz 2560x1664 display",
          ports: [
            "Two Thunderbolt 4 ports",
            "One USB 3.1 Type-A port",
            "SD card reader",
            "Audio Jack"
          ],
          upgrades: {
            display: ["13.7-inch IPS 120Hz 2560x1664 display (base)", "13.7-inch OLED 120Hz 2560x1664 display (+$200)"],
            chip: ["Boiby B5 chip with 9-core CPU and 10-core GPU (base)", "Boiby B5 chip with 10-core CPU and 12-core GPU (+$100)"],
            memory: ["16 GB unified memory (base)", "24 GB unified memory (+$100)", "32 GB unified memory (+$200)"],
            storage: ["512 GB SSD storage (base)", "1 TB SSD storage (+$100)", "2 TB SSD storage (+$200)"/*, "4 TB SSD storage (+$400)" */],
            coating: ["No anti-reflective coating (base)", "Anti-reflective coating (+$100)"]
          }
        }
      };

      const template15 = {
        "B5": {
          price: 1999,
          display: "15.3-inch IPS 120Hz 2880x1864 display",
          ports: [
            "Two Thunderbolt 4 ports",
            "One USB 3.1 Type-A port",
            "SD card reader",
            "Audio Jack"
          ],
          upgrades: {
            display: ["15.3-inch IPS 120Hz 2880x1864 display (base)", "15.3-inch OLED 120Hz 2880x1864 display (+$250)"],
            chip: ["Boiby B5 chip with 10-core CPU and 12-core GPU (base)"],
            memory: ["16 GB unified memory (base)", "24 GB unified memory (+$100)", "32 GB unified memory (+$200)"],
            storage: ["512 GB SSD storage (base)", "1 TB SSD storage (+$100)", "2 TB SSD storage (+$200)"/*, "4 TB SSD storage (+$400)"*/],
            coating: ["No anti-reflective coating (base)", "Anti-reflective coating (+$100)"]
          }
        }
      };

      const baseConfigs = { '13': {}, '15': {} };
      baseConfigs['13'] = JSON.parse(JSON.stringify(template13));
      baseConfigs['15'] = JSON.parse(JSON.stringify(template15));

      let selectedSize = '13';
      let selectedModel = null;
      let selectedOptions = {};

      const $ = q => document.querySelector(q);
      const $$ = q => Array.from(document.querySelectorAll(q));
      const cleanLabel = opt => (opt||'').split("(")[0].trim();
      const priceDelta = opt => {
        if (!opt) return 0;
        const m = opt.match(/\+\$(\d+)/);
        return m ? parseInt(m[1],10) : 0;
      };
      const formatPrice = n => `$${n.toLocaleString('en-US')}`;

      function initTabs() {
        const tabs = $$('.tab[data-size]');
        if (!tabs.length) return;
        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            // Fade effect
            document.body.classList.add('fade-out');
            
            setTimeout(() => {
              tabs.forEach(t => t.classList.remove('active'));
              tab.classList.add('active');
              const size = tab.getAttribute('data-size');
              if (sizes.includes(size)) {
                selectedSize = size;
                // Update header
                $('#headerTitle').textContent = `Buy BoibyBook Air ${size}-inch`;
                renderModels();
              }
              
              // Fade back in
              document.body.classList.remove('fade-out');
            }, 300);
          });
        });
      }

      function renderModels() {
        const container = $('#models');
        if (!container) return;
        container.innerHTML = '';
        const configs = baseConfigs[selectedSize];
        Object.keys(configs).forEach(model => {
          const cfg = configs[model];
          const card = document.createElement('div');
          card.className = 'card';
          card.setAttribute('data-model', model);
          
          // Create image element
          const imageUrl = `BoibyBookAir${selectedColor.replace(/\s+/g, '')}.png`;
          
          card.innerHTML = `
            <div class="card-content">
              <div class="card-image">
                <img src="${imageUrl}" alt="${model} ${selectedColor}" id="card-image-${model.replace(/\s+/g, '-')}">
              </div>
              <div class="card-details">
                <h2>${selectedSize}-inch BoibyBook Air - ${model}</h2>
                <p class="price">From ${formatPrice(cfg.price)}</p>
                <ul>
                  <li>${cfg.display}</li>
                  <li>${cleanLabel(cfg.upgrades.chip[0])}</li>
                  <li>${cleanLabel(cfg.upgrades.memory[0])}</li>
                  <li>${cleanLabel(cfg.upgrades.storage[0])}</li>
                  <li>${cleanLabel(cfg.upgrades.coating[0])}</li>
                </ul>
                <p><strong>Ports:</strong></p>
                <ul>
                  ${cfg.ports.map(port => `<li>${port}</li>`).join('')}
                </ul>
              </div>
            </div>
            <div class="color-selector">
              ${colors.map(color => `
                <div class="color-pill ${color === selectedColor ? 'selected' : ''}" 
                     data-color="${color}" data-model="${model}">
                  ${color}
                </div>
              `).join('')}
            </div>
            <button class="select-btn" data-model="${model}">Select</button>
          `;
          
          // Add color selection event
          card.querySelectorAll('.color-pill').forEach(pill => {
            pill.addEventListener('click', (e) => {
              e.stopPropagation();
              const color = pill.getAttribute('data-color');
              const model = pill.getAttribute('data-model');
              
              // Update all color pills for this model
              card.querySelectorAll('.color-pill').forEach(p => {
                p.classList.toggle('selected', p.getAttribute('data-color') === color);
              });
              
              // Update image with fade effect
              const image = card.querySelector('img');
              image.style.opacity = 0;
              
              setTimeout(() => {
                image.src = `BoibyBookAir${color.replace(/\s+/g, '')}.png`;
                image.style.opacity = 1;
              }, 150);
            });
          });
          
          // Add select button event
          card.querySelector('.select-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            const model = e.target.getAttribute('data-model');
            selectedModel = model;
            
            // Get selected color for this model
            const selectedColorPill = card.querySelector('.color-pill.selected');
            selectedColor = selectedColorPill ? selectedColorPill.getAttribute('data-color') : 'Silver';
            
            const modelsEl = $('#models');
            if (modelsEl) modelsEl.style.display = 'none';
            $('#configurator').style.display = 'block';
            // Hide size tabs when a model is selected
            $('#sizeTabs').style.display = 'none';
            showConfigurator();
          });
          
          container.appendChild(card);
        });
      }

      function showConfigurator() {
        const cfg = baseConfigs[selectedSize][selectedModel];
        const optionsDiv = $('#options');
        optionsDiv.innerHTML = '';
        selectedOptions = {};

        $('#heroTitle').innerText = `Customise your BoibyBook Air — ${selectedModel} ${selectedSize}"`;
        
        // Update hero image
        const heroImage = $('#heroImage');
        heroImage.innerHTML = `<img src="BoibyBookAir${selectedColor.replace(/\s+/g, '')}.png" alt="${selectedModel} ${selectedColor}">`;

        // upgrades
        Object.keys(cfg.upgrades).forEach(category => {
          const group = document.createElement('div');
          group.className = 'group';
          const h3 = document.createElement('h3');
          
          // Add info icon for memory category
          if (category === 'memory') {
            h3.innerHTML = `Memory <span class="info-icon" data-category="memory">?</span>`;
          } else {
            h3.innerText = category.charAt(0).toUpperCase() + category.slice(1);
          }
          
          group.appendChild(h3);

          cfg.upgrades[category].forEach((opt, idx) => {
            const pill = document.createElement('div');
            pill.className = 'pill';
            pill.dataset.cat = category;
            pill.dataset.value = opt;
            pill.innerHTML = `<span class="label">${cleanLabel(opt)}</span><span class="price-right">${priceDelta(opt) ? ('+$' + priceDelta(opt)) : ''}</span>`;

            pill.addEventListener('click', () => {
              if (pill.classList.contains('disabled')) return;
              // single-select logic
              Array.from(group.querySelectorAll('.pill')).forEach(s => s.classList.remove('selected'));
              pill.classList.add('selected');
              selectedOptions[category] = pill.dataset.value;
              renderHeroSummary();
              updatePrice();
            });

            // Default selection logic
            if (idx === 0) {
              pill.classList.add('selected');
              selectedOptions[category] = pill.dataset.value;
            }

            group.appendChild(pill);
          });

          if (category === 'memory') {
            const note = document.createElement('div');
            note.className = 'note';
            note.innerText = 'Choose a memory upgrade if you need extra multitasking headroom.';
            group.appendChild(note);
            
            // Add event listener to the info icon
            const infoIcon = h3.querySelector('.info-icon');
            if (infoIcon) {
              infoIcon.addEventListener('click', showMemoryModal);
            }
          }

          optionsDiv.appendChild(group);
        });

        renderHeroSummary();
        updatePrice();
      }

      function showMemoryModal() {
        const modal = $('#memoryModal');
        modal.classList.add('visible');
        
        // Add event listener to close button
        const closeButton = modal.querySelector('.modal-close');
        closeButton.addEventListener('click', hideMemoryModal);
        
        // Close modal when clicking outside
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            hideMemoryModal();
          }
        });
        
        // Close modal with Escape key
        document.addEventListener('keydown', function escHandler(e) {
          if (e.key === 'Escape') {
            hideMemoryModal();
            document.removeEventListener('keydown', escHandler);
          }
        });
      }
      
      function hideMemoryModal() {
        const modal = $('#memoryModal');
        modal.classList.remove('visible');
      }

      function renderHeroSummary() {
        const list = $('#heroList');
        if (!list) return;
        list.innerHTML = '';
        const cfg = baseConfigs[selectedSize][selectedModel];
        list.appendChild(li(`${selectedModel} ${selectedSize}" — ${cfg.display}`));
        list.appendChild(li(`Color: ${selectedColor}`));
        
        // Add ports information
        list.appendChild(li("Ports:"));
        cfg.ports.forEach(port => {
          list.appendChild(li(`• ${port}`));
        });
        
        const order = ['display', 'chip', 'memory', 'storage', 'coating'];
        order.forEach(cat => {
          if (selectedOptions[cat]) list.appendChild(li(cleanLabel(selectedOptions[cat])));
        });
      }

      function updatePrice() {
        const cfg = baseConfigs[selectedSize][selectedModel];
        let price = cfg.price;
        Object.keys(selectedOptions).forEach(cat => {
          price += priceDelta(selectedOptions[cat]);
        });
        $('#finalPrice').innerText = `Total: ${formatPrice(price)}`;
      }

      function showConfirmation() {
        const cfg = baseConfigs[selectedSize][selectedModel];
        let price = cfg.price;
        
        // Hide configurator and checkout, show confirmation
        $('#configurator').style.display = 'none';
        $('#checkout').style.display = 'none';
        $('#confirmation').style.display = 'block';
        
        // Set confirmation image
        $('#confirmationImage').innerHTML = `<img src="BoibyBookAir${selectedColor.replace(/\s+/g, '')}.png" alt="${selectedModel} ${selectedColor}">`;
        
        // Set confirmation model text
        $('#confirmationModel').textContent = `${selectedModel} ${selectedSize}" - ${selectedColor}`;
        
        // Build confirmation list
        const list = $('#confirmationList');
        list.innerHTML = '';
        
        list.appendChild(li(`Model: ${selectedModel} ${selectedSize}"`));
        list.appendChild(li(`Color: ${selectedColor}`));
        list.appendChild(li(cleanLabel(selectedOptions.display || cfg.upgrades.display[0])));
        list.appendChild(li(cleanLabel(selectedOptions.chip || cfg.upgrades.chip[0])));
        list.appendChild(li(cleanLabel(selectedOptions.memory || cfg.upgrades.memory[0])));
        list.appendChild(li(cleanLabel(selectedOptions.storage || cfg.upgrades.storage[0])));
        list.appendChild(li(cleanLabel(selectedOptions.coating || cfg.upgrades.coating[0])));
        
        // Calculate final price
        Object.keys(selectedOptions).forEach(cat => {
          price += priceDelta(selectedOptions[cat]);
        });
        
        $('#confirmationTotal').textContent = `Total: ${formatPrice(price)}`;
      }

      function li(text) { 
        const el = document.createElement('li'); 
        el.textContent = text; 
        return el; 
      }

      const backBtn = $('#backBtn');
      if (backBtn) backBtn.addEventListener('click', () => {
        $('#configurator').style.display = 'none';
        $('#models').style.display = 'grid';
        // Show size tabs again when going back
        $('#sizeTabs').style.display = 'flex';
      });

      const confirmationBackBtn = $('#confirmationBackBtn');
      if (confirmationBackBtn) confirmationBackBtn.addEventListener('click', () => {
        $('#confirmation').style.display = 'none';
        $('#models').style.display = 'grid';
        $('#checkout').style.display = 'flex';
        // Show size tabs again when going back
        $('#sizeTabs').style.display = 'flex';
      });

      const addToBagBtn = $('#addToBagBtn');
      if (addToBagBtn) addToBagBtn.addEventListener('click', showConfirmation);

      document.addEventListener('DOMContentLoaded', () => {
        initTabs();
        renderModels();
        const tabs = $$('.tab[data-size]');
        if (tabs.length) tabs.forEach(t => t.classList.toggle('active', t.getAttribute('data-size') === selectedSize));
      });

    })();
  </script>
</body>
</html>
