<script>
const basePrice = 7999
const config = {
  chip: [
    "Boiby Ultra (base)",
    "Boiby Max (+A$1200)",
    "Boiby Extreme (+A$2500)"
  ],
  upgrades: {
    memory: [
      "64 GB DDR5-5600 ECC memory [4 x 16 GB] (base)",
      "96 GB DDR5-5600 ECC memory [6 x 16 GB] (+A$400)",
      "128 GB DDR5-5600 ECC memory [8 x 16 GB] (+A$800)"
    ],
    storage_main: [
      "2 TB PCIe Gen 5 SSD (base)",
      "4 TB PCIe Gen 5 SSD (+A$400)",
      "8 TB PCIe Gen 5 SSD (+A$900)"
    ],
    storage_secondary: [
      "No secondary storage (base)",
      "4 TB PCIe Gen 5 SSD (+A$600)",
      "8 TB PCIe Gen 5 SSD (+A$1200)"
    ],
    graphics: [
      "Boiby X600 GPU (base)",
      "Boiby X800 GPU (+A$1000)",
      "Boiby X1200 GPU (+A$2000)"
    ],
    encode: [
      "No encoding accelerator (base)",
      "Boiby Afterburner (+A$2500)"
    ],
    ethernet: [
      "10Gb Ethernet (base)",
      "25Gb Ethernet (+A$300)"
    ],
    addons: [
      "No additional modules (base)",
      "Boiby ColorSync Module (+A$400)",
      "Boiby SoundCore Pro (+A$700)"
    ]
  }
}

const selectedOptions = {}

function li(text) {
  const el = document.createElement("li")
  el.textContent = text
  return el
}

function cleanLabel(text) {
  return text.replace(/\s*\(base\)/, "").replace(/\(\+A\$[0-9,]+\)/, "").trim()
}

function parsePrice(option) {
  const match = option.match(/\+A\$([0-9,]+)/)
  return match ? parseInt(match[1].replace(/,/g, "")) : 0
}

function renderHeroSummary() {
  const list = document.getElementById("heroList")
  list.innerHTML = ""
  const order = ["chip","memory","storage_main","storage_secondary","graphics","encode","ethernet","addons"]
  order.forEach(category => {
    const val = selectedOptions[category]
    if (!val) return
    if (Array.isArray(val)) val.forEach(opt => list.appendChild(li(cleanLabel(opt))))
    else list.appendChild(li(cleanLabel(val)))
  })
}

function updateTotal() {
  let total = basePrice
  for (const cat in selectedOptions) {
    const val = selectedOptions[cat]
    if (Array.isArray(val)) val.forEach(v => total += parsePrice(v))
    else total += parsePrice(val)
  }
  document.getElementById("price").textContent = "A$" + total.toLocaleString()
}

function renderOptions() {
  const optionsDiv = document.getElementById("options")
  optionsDiv.innerHTML = ""
  const categories = { chip: config.chip, ...config.upgrades }

  for (const category in categories) {
    const group = document.createElement("div")
    group.classList.add("group")
    const title = document.createElement("h3")
    title.textContent = category.replace(/_/g, " ").toUpperCase()
    group.appendChild(title)

    categories[category].forEach((opt, idx) => {
      const pill = document.createElement("div")
      pill.className = "pill"
      pill.textContent = opt

      pill.addEventListener("click", () => {
        if (pill.classList.contains("disabled")) return
        group.querySelectorAll(".pill").forEach(p => p.classList.remove("selected"))
        pill.classList.add("selected")
        selectedOptions[category] = opt

        if (category === "chip") {
          const memGroup = [...document.querySelectorAll(".group h3")]
            .find(h => h.textContent.toLowerCase().includes("memory"))?.parentElement

          if (memGroup) {
            const memPills = memGroup.querySelectorAll(".pill")
            memPills.forEach(p => {
              const text = p.textContent
              p.classList.remove("disabled")

              if (opt.includes("Boiby Ultra") && text.includes("128 GB")) p.classList.add("disabled")
              if (opt.includes("Boiby Max") && text.includes("96 GB")) p.classList.add("disabled")
            })

            const selectedMem = memGroup.querySelector(".pill.selected")
            const availableMem = memGroup.querySelector(".pill:not(.disabled)")
            if (!selectedMem || selectedMem.classList.contains("disabled")) {
              memPills.forEach(p => p.classList.remove("selected"))
              if (availableMem) {
                availableMem.classList.add("selected")
                selectedOptions.memory = availableMem.textContent.trim()
              }
            }
          }
        }

        renderHeroSummary()
        updateTotal()
      })

      if (idx === 0 && !pill.classList.contains("disabled")) {
        pill.classList.add("selected")
        selectedOptions[category] = opt
      }

      group.appendChild(pill)
    })

    optionsDiv.appendChild(group)
  }

  renderHeroSummary()
  updateTotal()
}

document.addEventListener("DOMContentLoaded", renderOptions)
</script>
