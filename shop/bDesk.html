<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Buy bDesk</title>
  <style>
    :root {
      --blue: #0071e3;
      --border: #d2d2d7;
      --text: #1d1d1f;
      --muted: #6e6e73;
      --bg: #fff;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      transition: opacity 0.3s ease;
    }

    body.fade-out {
      opacity: 0.5;
    }

    header {
      text-align: center;
      padding: 28px 16px;
      border-bottom: 1px solid var(--border);
      transition: all 0.3s ease;
    }
    
    h1 {
      font-size: 1.9rem;
      margin: 0;
      font-weight: 700;
    }

    .models, .configurator, .confirmation {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
    }
    
    .models {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 25px;
    }
    
    .card {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      background: #fff;
      transition: box-shadow .15s, transform .06s;
      display: flex;
      flex-direction: column;
    }
    
    .card:hover {
      border-color: var(--blue);
      transform: translateY(-2px);
    }
    
    .card-content {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .card-image {
      width: 140px;
      height: 140px;
      border-radius: 8px;
      overflow: hidden;
      background: #f5f5f7;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .card-image img {
      max-width: 100%;
      max-height: 100%;
      transition: opacity 0.3s ease;
    }
    
    .card-details {
      flex: 1;
    }
    
    .card h2 {
      font-size: 1.3rem;
      margin: 0 0 6px;
      font-weight: 600;
    }
    
    .price {
      font-size: 1.05rem;
      font-weight: 500;
      margin: 6px 0 12px;
      color: var(--muted);
    }
    
    .card ul {
      margin: 0;
      padding-left: 20px;
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    .select-btn {
      margin-top: auto;
      padding: 10px 0;
      background: var(--blue);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background .2s;
    }
    
    .select-btn:hover {
      background: #005bB6;
    }

    .back-btn {
      margin: 10px 0 20px;
      padding: 8px 18px;
      background: #f5f5f7;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.95rem;
    }
    
    .back-btn:hover { 
      background: #e6e6e9; 
    }

    .hero { 
      margin-bottom: 24px; 
    }
    
    .hero-title {
      font-size: clamp(1.8rem, 4vw, 2.4rem);
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1.2;
      margin: 0 0 12px;
    }
    
    .hero-content {
      display: flex;
      gap: 30px;
      align-items: flex-start;
    }
    
    .hero-image {
      width: 280px;
      flex-shrink: 0;
      border-radius: 0;
      overflow: hidden;
    }
    
    .hero-image img {
      width: 100%;
      display: block;
      transition: opacity 0.3s ease;
    }
    
    .hero-list {
      list-style: none;
      padding: 0;
      margin: 0;
      color: var(--muted);
      flex: 1;
    }
    
    .hero-list li {
      font-size: 1rem;
      line-height: 1.6;
      margin: 6px 0;
    }

    .group { 
      margin: 24px 0; 
      position: relative;
    }
    
    .group h3 {
      font-size: 1.1rem;
      margin: 0 0 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .info-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--muted);
      color: white;
      font-size: 12px;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .info-icon:hover {
      background: var(--blue);
    }

    .pill {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 28px 20px;
      border: 1px solid var(--border);
      border-radius: 12px;
      margin: 10px 0;
      cursor: pointer;
      background: #fff;
      transition: border-color .12s, box-shadow .12s, transform .06s;
    }
    
    .pill:hover { 
      border-color: var(--blue); 
      transform: translateY(-2px); 
    }
    
    .pill.selected {
      border: 2px solid var(--blue);
      box-shadow: 0 4px 14px rgba(0,113,227,0.08);
    }
    
    .pill.disabled {
      opacity: .6;
      cursor: not-allowed;
      background: #fbfbfb;
    }
    
    .pill .label { 
      font-weight: 600; 
    }
    
    .pill .price-right { 
      color: var(--muted); 
      font-weight: 600; 
      white-space: nowrap; 
    }

    .note {
      font-size: .9rem;
      color: var(--muted);
      margin-top: 6px;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .modal-overlay.visible {
      opacity: 1;
      visibility: visible;
    }
    
    .modal {
      background: white;
      border-radius: 16px;
      padding: 24px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }
    
    .modal-overlay.visible .modal {
      transform: translateY(0);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .modal-title {
      font-size: 1.4rem;
      font-weight: 600;
      margin: 0;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--muted);
    }
    
    .modal-content {
      line-height: 1.6;
    }
    
    .modal-content p {
      margin: 0 0 16px;
    }
    
    .modal-content ul {
      margin: 0 0 16px;
      padding-left: 20px;
    }

    .checkout {
      position: sticky;
      bottom: 0;
      left: 0;
      right: 0;
      width: auto;
      max-width: 100vw;
      box-sizing: border-box;
      background: #fff;
      border-top: 1px solid var(--border);
      padding: 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
      z-index: 100;
      overflow-x: hidden;
    }
    
    .total {
      font-size: 1.4rem;
      font-weight: 700;
    }
    
    .add-to-bag {
      padding: 12px 22px;
      font-size: 1.05rem;
      background: var(--blue);
      color: #fff;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      transition: background .2s;
    }
    
    .add-to-bag:hover { 
      background: #005bB6; 
    }

    .confirmation {
      text-align: center;
      display: none;
    }
    
    .confirmation-image {
      width: 300px;
      margin: 0 auto 20px;
      border-radius: 12px;
      overflow: hidden;
    }
    
    .confirmation-image img {
      width: 100%;
    }
    
    .confirmation-details {
      max-width: 600px;
      margin: 0 auto;
      text-align: left;
      background: #f9f9f9;
      padding: 20px;
      border-radius: 12px;
    }
    
    .confirmation-title {
      font-size: 2.2rem;
      margin-bottom: 10px;
      color: #0071e3;
    }
    
    .confirmation-model {
      font-size: 1.4rem;
      margin-bottom: 20px;
    }
    
    .confirmation-list {
      list-style: none;
      padding: 0;
      margin: 0 0 20px;
    }
    
    .confirmation-list li {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    
    .confirmation-total {
      font-size: 1.6rem;
      font-weight: 700;
      text-align: center;
      margin-top: 20px;
    }

    @media (max-width: 900px) {
      .models {
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      }
      
      .hero-content {
        flex-direction: column;
      }
      
      .hero-image {
        width: 100%;
        max-width: 300px;
        margin: 0 auto;
      }
    }

    @media (max-width: 600px) {
      .pill { 
        padding: 14px; 
      }
      
      .checkout {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
      }
      
      .add-to-bag { 
        width: 100%; 
      }
      
      .card-content {
        flex-direction: column;
      }
      
      .card-image {
        width: 100%;
        height: 180px;
        margin-bottom: 15px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1 id="headerTitle">Buy bDesk</h1>
  </header>

  <main>
    <div class="models" id="models"><!-- cards inserted by JS --></div>

    <div class="configurator" id="configurator" style="display:none;">
      <button class="back-btn" id="backBtn">← Back</button>
      <div class="hero">
        <h2 class="hero-title" id="heroTitle"></h2>
        <div class="hero-content">
          <div class="hero-image" id="heroImage"></div>
          <ul class="hero-list" id="heroList"></ul>
        </div>
      </div>
      <div id="options"></div>
    </div>

    <div class="confirmation" id="confirmation">
      <h2 class="confirmation-title">Order Confirmed!</h2>
      <div class="confirmation-image" id="confirmationImage"></div>
      <h3 class="confirmation-model" id="confirmationModel"></h3>
      <div class="confirmation-details">
        <h4>Order Summary:</h4>
        <ul class="confirmation-list" id="confirmationList"></ul>
        <div class="confirmation-total" id="confirmationTotal"></div>
      </div>
      <button class="back-btn" id="confirmationBackBtn" style="margin-top: 30px;">← Back to Store</button>
    </div>
  </main>

  <div class="modal-overlay" id="memoryModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Memory Guide</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-content">
        <p><strong>How much memory is right for you?</strong></p>
        <p>Our unified memory architecture allows the CPU and GPU to access the same memory pool, improving performance and efficiency. Here is a general guide to how much you might need:</p>
        
        <p><strong>16 GB:</strong> Good for general users, students, and users with standard workloads. This configuration is ideal for those who primarily browse the web, stream content, use productivity apps, do light video and photo editing, and perform multitasking</p>
        
        <p><strong>24 GB:</strong> Good for users who need slightly more headroom for multitasking and moderate creative work. Ideal for those who do light to moderate video editing, gaming, graphic design, or programming, but don't push those to the extreme. Good for users who run multiple intensive apps simultaneously and perform more multitasking.</p>
        
        <p><strong>32 GB:</strong> Best for users engaging in more intensive workflows, such as video editing in 4K, music production with multiple tracks, large-scale coding projects, working with 3D models, playing memory-intensive simulator games, or using virtual machines.</p>
      </div>
    </div>
  </div>

  <div class="checkout" id="checkout">
    <div class="total" id="finalPrice">Total: $0</div>
    <button class="add-to-bag" id="addToBagBtn">Add to Bag</button>
  </div>

  <script>
    (function () {
      const colors = ['Silver']; // Only Silver available for bDesk
      let selectedColor = 'Silver';

      const template = {
        "24-inch": {
          price: 1799,
          display: "24-inch 4.5K IPS display",
          ports: [
            "3 Thunderbolt 5 (USB Type-C) ports",
            "2 USB 3 (Type-A) ports",
            "Headphone Jack",
            "Gigabit Ethernet"
          ],
          upgrades: {
            display: ["24-inch 4.5K IPS display (base)"],
            chip: [
              // B6 configurations
              "Boiby B6 chip with 9-core CPU and 10-core GPU (base)", 
              "Boiby B6 chip with 10-core CPU and 12-core GPU (+$100)",
              // B6 Pro configurations
              "Boiby B6 Pro chip with 13-core CPU and 20-core GPU (+$500)",
              "Boiby B6 Pro chip with 14-core CPU and 24-core GPU (+$800)"
            ],
            memory: [
              "16 GB unified memory (base)", 
              "24 GB unified memory (+$100)", 
              "32 GB unified memory (+$200)",
              "48 GB unified memory (+$400)",
              "64 GB unified memory (+$600)"
            ],
            storage: [
              "512 GB SSD storage (base)", 
              "1 TB SSD storage (+$100)", 
              "2 TB SSD storage (+$200)",
              "4 TB SSD storage (+$400)",
              "8 TB SSD storage (+$800)"
            ],
            ethernet: ["Gigabit Ethernet (base)", "2.5 Gigabit Ethernet (+$50)"],
            coating: ["No anti-reflective coating (base)", "Anti-reflective coating (+$150)"],
            keyboard: ["Pro Keyboard with Touch ID (base)", "Pro Keyboard with Touch ID + Numpad (+$50)"],
            mouse: ["Pro Mouse (base)", "Pro Trackpad + Pro Mouse (+$50)"]
          }
        },
        "28-inch": {
          price: 2999,
          display: "28-inch 5K IPS display",
          ports: [
            "4 Thunderbolt 5 (USB Type-C) ports",
            "3 USB 3 (Type-A) ports",
            "Headphone Jack",
            "2.5 Gigabit Ethernet",
            "SD Express card reader"
          ],
          upgrades: {
            display: ["28-inch 5K IPS display (base)"],
            chip: [
              "Boiby B6 Pro chip with 13-core CPU and 20-core GPU (base)",
              "Boiby B6 Pro chip with 14-core CPU and 24-core GPU (+$300)"
            ],
            memory: [
              "32 GB unified memory (base)",
              "48 GB unified memory (+$200)",
              "64 GB unified memory (+$400)"
            ],
            storage: [
              "1 TB SSD storage (base)",
              "2 TB SSD storage (+$100)",
              "4 TB SSD storage (+$300)",
              "8 TB SSD storage (+$700)"
            ],
            ethernet: ["2.5 Gigabit Ethernet (base)", "10 Gigabit Ethernet (+$100)"],
            coating: ["No anti-reflective coating (base)", "Anti-reflective coating (+$150)"],
            keyboard: ["Pro Keyboard with Touch ID (base)", "Pro Keyboard with Touch ID + Numpad (+$50)"],
            mouse: ["Pro Mouse (base)", "Pro Trackpad + Pro Mouse (+$50)"]
          }
        }
      };

      const baseConfigs = JSON.parse(JSON.stringify(template));

      let selectedModel = null;
      let selectedOptions = {};

      const $ = q => document.querySelector(q);
      const $$ = q => Array.from(document.querySelectorAll(q));
      const cleanLabel = opt => (opt||'').split("(")[0].trim();
      const priceDelta = opt => {
        if (!opt) return 0;
        const m = opt.match(/\+\$(\d+)/);
        return m ? parseInt(m[1],10) : 0;
      };
      const formatPrice = n => `$${n.toLocaleString('en-US')}`;

      // Memory guide for combined B6/Pro model
      const memoryGuides = {
        '24-inch': `
          <p><strong>How much memory is right for you?</strong></p>
          <p>Our unified memory architecture allows the CPU and GPU to access the same memory pool, improving performance and efficiency. Here is a general guide to how much you might need:</p>
          
          <p><strong>16 GB:</strong> Good for general users, students, and users with standard workloads. This configuration is ideal for those who primarily browse the web, stream content, use productivity apps, do light video and photo editing, and perform multitasking</p>
          
          <p><strong>24 GB:</strong> Good for users who need slightly more headroom for multitasking and moderate creative work. Ideal for those who do light to moderate video editing, gaming, graphic design, or programming, but don't push those to the extreme.</p>
          
          <p><strong>32 GB:</strong> Best for users engaging in more intensive workflows, such as video editing in 4K, music production with multiple tracks, large-scale coding projects, working with 3D models, playing memory-intensive simulator games, or using virtual machines.</p>
          
          <p><strong>48 GB or more:</strong> For professionals who have highly memory-intensive workflows. Ideal for multi-layer 4K video editing, multiple virtual machines, compiling very large projects, working with very complex 3D models and animations, running simulations, or moderate machine learning workloads.</p>
        `,
        '28-inch': `
          <p><strong>How much memory is right for you?</strong></p>
          <p>Our unified memory architecture allows the CPU and GPU to access the same memory pool, improving performance and efficiency. Here is a general guide to how much you might need:</p>
          
          <p><strong>32 GB:</strong> Best for users engaging in more intensive workflows, such as video editing in 4K, music production with multiple tracks, large-scale coding projects, working with 3D models, playing memory-intensive simulator games, or using virtual machines.</p>
          
          <p><strong>48 GB or more:</strong> For professionals who have highly memory-intensive workflows. Ideal for multi-layer 4K video editing, multiple virtual machines, compiling very large projects, working with very complex 3D models and animations, running simulations, or moderate machine learning workloads.</p>
        `
      };

      function renderModels() {
        const container = $('#models');
        if (!container) return;
        container.innerHTML = '';
        const configs = baseConfigs;
        Object.keys(configs).forEach(model => {
          const cfg = configs[model];
          const card = document.createElement('div');
          card.className = 'card';
          card.setAttribute('data-model', model);
          
          // Create image element
          const imageUrl = `bDeskSilver.png`;
          
          card.innerHTML = `
            <div class="card-content">
              <div class="card-image">
                <img src="${imageUrl}" alt="${model} ${selectedColor}" id="card-image-${model.replace(/\s+/g, '-')}">
              </div>
              <div class="card-details">
                <h2>bDesk - ${model}</h2>
                <p class="price">From ${formatPrice(cfg.price)}</p>
                <ul>
                  <li>${cfg.display}</li>
                  <li>${cleanLabel(cfg.upgrades.chip[0])}</li>
                  <li>${cleanLabel(cfg.upgrades.memory[0])}</li>
                  <li>${cleanLabel(cfg.upgrades.storage[0])}</li>
                  <li>${cleanLabel(cfg.upgrades.ethernet[0])}</li>
                  <li>${cleanLabel(cfg.upgrades.coating[0])}</li>
                  <li>${cleanLabel(cfg.upgrades.keyboard[0])}</li>
                  <li>${cleanLabel(cfg.upgrades.mouse[0])}</li>
                </ul>
                <p><strong>Ports:</strong></p>
                <ul>
                  ${cfg.ports.map(port => `<li>${port}</li>`).join('')}
                </ul>
              </div>
            </div>
            <button class="select-btn" data-model="${model}">Select</button>
          `;
          
          // Add select button event
          card.querySelector('.select-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            const model = e.target.getAttribute('data-model');
            selectedModel = model;
            
            const modelsEl = $('#models');
            if (modelsEl) modelsEl.style.display = 'none';
            $('#configurator').style.display = 'block';
            showConfigurator();
          });
          
          container.appendChild(card);
        });
      }

      function showConfigurator() {
        const cfg = baseConfigs[selectedModel];
        const optionsDiv = $('#options');
        optionsDiv.innerHTML = '';
        selectedOptions = {};

        $('#heroTitle').innerText = `Customise your bDesk — ${selectedModel}`;
        
        // Update hero image
        const heroImage = $('#heroImage');
        heroImage.innerHTML = `<img src="bDeskSilver.png" alt="${selectedModel} ${selectedColor}">`;

        // upgrades
        Object.keys(cfg.upgrades).forEach(category => {
          const group = document.createElement('div');
          group.className = 'group';
          const h3 = document.createElement('h3');
          
          // Add info icon for memory category
          if (category === 'memory') {
            h3.innerHTML = `Memory <span class="info-icon" data-category="memory">?</span>`;
          } else {
            h3.innerText = category.charAt(0).toUpperCase() + category.slice(1);
          }
          
          group.appendChild(h3);

          cfg.upgrades[category].forEach((opt, idx) => {
            const pill = document.createElement('div');
            pill.className = 'pill';
            pill.dataset.cat = category;
            pill.dataset.value = opt;
            pill.innerHTML = `<span class="label">${cleanLabel(opt)}</span><span class="price-right">${priceDelta(opt) ? ('+$' + priceDelta(opt)) : ''}</span>`;

            pill.addEventListener('click', () => {
              if (pill.classList.contains('disabled')) return;
              // single-select logic
              Array.from(group.querySelectorAll('.pill')).forEach(s => s.classList.remove('selected'));
              pill.classList.add('selected');
              selectedOptions[category] = pill.dataset.value;
              if (category === 'chip') handleDependencies(); // re-evaluate when chip changes
              renderHeroSummary();
              updatePrice();
            });

            // Default selection logic
            if (idx === 0) {
              pill.classList.add('selected');
              selectedOptions[category] = pill.dataset.value;
            }

            group.appendChild(pill);
          });

          if (category === 'memory') {
            const note = document.createElement('div');
            note.className = 'note';
            note.innerText = 'Choose Boiby B6 Pro chip to select more than 32 GB unified memory.';
            group.appendChild(note);
            
            // Add event listener to the info icon
            const infoIcon = h3.querySelector('.info-icon');
            if (infoIcon) {
              infoIcon.addEventListener('click', () => showMemoryModal(selectedModel));
            }
          }

          optionsDiv.appendChild(group);
        });

        // Apply dependency logic
        handleDependencies();
        renderHeroSummary();
        updatePrice();
      }

      function handleDependencies() {
        if (!selectedModel) return;

        const cfg = baseConfigs[selectedModel];
        const optionsDiv = $('#options');
        if (!optionsDiv) return;

        const chipFull = selectedOptions.chip || cfg.upgrades.chip[0];
        
        // Select all memory pills directly using data-cat="memory"
        const memoryPills = Array.from(document.querySelectorAll('.pill[data-cat="memory"]'));
        const storagePills = Array.from(document.querySelectorAll('.pill[data-cat="storage"]'));
        
        if (!memoryPills.length || !storagePills.length) return;

        // Helper to get clean text for a pill
        const getPillText = (pill) => {
            const label = pill.querySelector('.label');
            return (label ? label.textContent : pill.textContent).trim();
        }

        // Helper to find a pill by text
        const findPill = (pills, text) => pills.find(p => getPillText(p).includes(text));

        // Remove all disabled classes first
        memoryPills.forEach(p => p.classList.remove('disabled'));
        storagePills.forEach(p => p.classList.remove('disabled'));

        if (selectedModel === '24-inch') {
            const mem16 = findPill(memoryPills, '16 GB');
            const mem24 = findPill(memoryPills, '24 GB');
            const mem32 = findPill(memoryPills, '32 GB');
            const mem48 = findPill(memoryPills, '48 GB');
            const mem64 = findPill(memoryPills, '64 GB');

            const storage512 = findPill(storagePills, '512 GB');
            const storage4TB = findPill(storagePills, '4 TB');
            const storage8TB = findPill(storagePills, '8 TB');

            const isB6Pro = chipFull.includes('B6 Pro');

            // Memory rules: B6 can have 16/24/32GB, B6 Pro can have 32/48/64GB
            if (isB6Pro) {
                // B6 Pro: Enable 32/48/64GB, disable 16/24GB
                if (mem16) mem16.classList.add('disabled');
                if (mem24) mem24.classList.add('disabled');
                if (mem32) mem32.classList.remove('disabled');
                if (mem48) mem48.classList.remove('disabled');
                if (mem64) mem64.classList.remove('disabled');
            } else {
                // B6: Enable 16/24/32GB, disable 48/64GB
                if (mem16) mem16.classList.remove('disabled');
                if (mem24) mem24.classList.remove('disabled');
                if (mem32) mem32.classList.remove('disabled');
                if (mem48) mem48.classList.add('disabled');
                if (mem64) mem64.classList.add('disabled');
            }

            // Storage rules: 512GB only on B6, 4TB/8TB only on B6 Pro
            if (isB6Pro) {
                // B6 Pro: Disable 512GB, enable 4TB/8TB
                if (storage512) storage512.classList.add('disabled');
                if (storage4TB) storage4TB.classList.remove('disabled');
                if (storage8TB) storage8TB.classList.remove('disabled');
            } else {
                // B6: Enable 512GB, disable 4TB/8TB
                if (storage512) storage512.classList.remove('disabled');
                if (storage4TB) storage4TB.classList.add('disabled');
                if (storage8TB) storage8TB.classList.add('disabled');
            }

            // Auto-select valid options if current selections are invalid
            autoSelectValidOption(memoryPills, 'memory', cfg.upgrades.memory);
            autoSelectValidOption(storagePills, 'storage', cfg.upgrades.storage);
        }

        renderHeroSummary();
        updatePrice();
      }

      function autoSelectValidOption(pills, category, availableOptions) {
        const currentValue = selectedOptions[category];
        const currentPill = pills.find(p => p.dataset.value === currentValue);
        
        if (currentPill && currentPill.classList.contains('disabled')) {
            // Current selection is invalid, find first available option
            pills.forEach(p => p.classList.remove('selected'));
            const firstAvailable = pills.find(p => !p.classList.contains('disabled'));
            if (firstAvailable) {
                firstAvailable.classList.add('selected');
                selectedOptions[category] = firstAvailable.dataset.value;
                console.log(`Auto-selected ${category}:`, selectedOptions[category]);
            }
        }
      }

      function showMemoryModal(model) {
        const modal = $('#memoryModal');
        const content = $('#memoryModal').querySelector('.modal-content');
        
        // Set content based on model
        content.innerHTML = memoryGuides[model] || memoryGuides['24-inch'];
        
        modal.classList.add('visible');
        
        // Add event listener to close button
        const closeButton = modal.querySelector('.modal-close');
        closeButton.addEventListener('click', hideMemoryModal);
        
        // Close modal when clicking outside
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            hideMemoryModal();
          }
        });
        
        // Close modal with Escape key
        document.addEventListener('keydown', function escHandler(e) {
          if (e.key === 'Escape') {
            hideMemoryModal();
            document.removeEventListener('keydown', escHandler);
          }
        });
      }
      
      function hideMemoryModal() {
        const modal = $('#memoryModal');
        modal.classList.remove('visible');
      }

      function renderHeroSummary() {
        const list = $('#heroList');
        if (!list) return;
        list.innerHTML = '';
        const cfg = baseConfigs[selectedModel];
        list.appendChild(li(`bDesk — ${selectedModel}`));
        list.appendChild(li(`Color: ${selectedColor}`));
        
        // Add ports information
        list.appendChild(li("Ports:"));
        cfg.ports.forEach(port => {
          list.appendChild(li(`• ${port}`));
        });
        
        const order = ['display', 'chip', 'memory', 'storage', 'ethernet', 'coating', 'keyboard', 'mouse'];
        order.forEach(cat => {
          if (selectedOptions[cat]) list.appendChild(li(cleanLabel(selectedOptions[cat])));
        });
      }

      function updatePrice() {
        const cfg = baseConfigs[selectedModel];
        let price = cfg.price;
        Object.keys(selectedOptions).forEach(cat => {
          price += priceDelta(selectedOptions[cat]);
        });
        $('#finalPrice').innerText = `Total: ${formatPrice(price)}`;
      }

      function showConfirmation() {
        const cfg = baseConfigs[selectedModel];
        let price = cfg.price;
        
        // Hide configurator and checkout, show confirmation
        $('#configurator').style.display = 'none';
        $('#checkout').style.display = 'none';
        $('#confirmation').style.display = 'block';
        
        // Set confirmation image
        $('#confirmationImage').innerHTML = `<img src="bDeskSilver.png" alt="${selectedModel} ${selectedColor}">`;
        
        // Set confirmation model text
        $('#confirmationModel').textContent = `bDesk - ${selectedModel} - ${selectedColor}`;
        
        // Build confirmation list
        const list = $('#confirmationList');
        list.innerHTML = '';
        
        list.appendChild(li(`Model: bDesk - ${selectedModel}`));
        list.appendChild(li(`Color: ${selectedColor}`));
        list.appendChild(li(cleanLabel(selectedOptions.display || cfg.upgrades.display[0])));
        list.appendChild(li(cleanLabel(selectedOptions.chip || cfg.upgrades.chip[0])));
        list.appendChild(li(cleanLabel(selectedOptions.memory || cfg.upgrades.memory[0])));
        list.appendChild(li(cleanLabel(selectedOptions.storage || cfg.upgrades.storage[0])));
        list.appendChild(li(cleanLabel(selectedOptions.ethernet || cfg.upgrades.ethernet[0])));
        list.appendChild(li(cleanLabel(selectedOptions.coating || cfg.upgrades.coating[0])));
        list.appendChild(li(cleanLabel(selectedOptions.keyboard || cfg.upgrades.keyboard[0])));
        list.appendChild(li(cleanLabel(selectedOptions.mouse || cfg.upgrades.mouse[0])));
        
        // Calculate final price
        Object.keys(selectedOptions).forEach(cat => {
          price += priceDelta(selectedOptions[cat]);
        });
        
        $('#confirmationTotal').textContent = `Total: ${formatPrice(price)}`;
      }

      function li(text) { 
        const el = document.createElement('li'); 
        el.textContent = text; 
        return el; 
      }

      const backBtn = $('#backBtn');
      if (backBtn) backBtn.addEventListener('click', () => {
        $('#configurator').style.display = 'none';
        $('#models').style.display = 'grid';
      });

      const confirmationBackBtn = $('#confirmationBackBtn');
      if (confirmationBackBtn) confirmationBackBtn.addEventListener('click', () => {
        $('#confirmation').style.display = 'none';
        $('#models').style.display = 'grid';
        $('#checkout').style.display = 'flex';
      });

      const addToBagBtn = $('#addToBagBtn');
      if (addToBagBtn) addToBagBtn.addEventListener('click', showConfirmation);

      document.addEventListener('DOMContentLoaded', () => {
        renderModels();
      });

    })();
</script>
</body>
</html>
